<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AgriSync â€“ Farmer Smart App</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:Arial;background:#f2f6f3;}
header{background:#1b8f4c;color:white;text-align:center;padding:15px;font-size:20px;font-weight:bold;}
.container{padding:15px;}
.card{background:white;padding:15px;margin-bottom:15px;border-radius:10px;box-shadow:0 3px 8px rgba(0,0,0,0.1);}
input,select{width:100%;padding:12px;margin-top:8px;margin-bottom:10px;border-radius:8px;border:1px solid #ccc;}
button{width:100%;padding:14px;background:#1b8f4c;color:white;border:none;border-radius:8px;font-size:16px;font-weight:bold;}
button:hover{background:#15753d;}
.success-box{background:#e8f7ee;padding:10px;border-radius:8px;margin-top:10px;}
.small{font-size:13px;color:gray;}
</style>
</head>

<body>

<header>ğŸŒ¾ AgriSync â€“ Farmer Smart App</header>

<div class="container">

<div class="card">
<h2>ğŸ“Š Platform Dashboard</h2>
<div id="dashboardStats">Loading dashboard...</div>
</div>

<div class="card">
<h2>ğŸ‘¨â€ğŸŒ¾ Register Farmer</h2>
<input id="farmerName" placeholder="Your Name">
<input id="farmerPhone" placeholder="Phone Number">
<input id="farmerLocation" placeholder="Village / City">
<button onclick="registerFarmer()">Register</button>
<div id="farmerResult"></div>
</div>

<div class="card">
<h2>ğŸŒ¾ Add Upcoming Harvest</h2>
<select id="cropName">
<option>Paddy</option>
<option>Tomato</option>
<option>Onion</option>
<option>Mango</option>
<option>Banana</option>
<option>Cotton</option>
</select>
<input type="number" id="quantity" placeholder="Quantity">
<select id="unit">
<option value="kg">kg</option>
<option value="quintal">quintal</option>
<option value="ton">ton</option>
</select>
<input type="date" id="harvestDate">
<button onclick="addHarvest()">Add Harvest</button>
<div id="harvestResult"></div>
</div>

<div class="card">
<h2>ğŸ›’ Register Buyer</h2>
<input id="buyerName" placeholder="Buyer Name">
<input id="buyerPhone" placeholder="Phone">
<input id="buyerLocation" placeholder="Market Location">
<button onclick="registerBuyer()">Register Buyer</button>
<div id="buyerResult"></div>
</div>

<div class="card">
<h2>ğŸ“¦ Create Demand</h2>
<input type="number" id="buyerIdInput" placeholder="Buyer ID">
<select id="demandCrop">
<option>Paddy</option>
<option>Tomato</option>
<option>Onion</option>
<option>Mango</option>
<option>Banana</option>
<option>Cotton</option>
</select>
<input type="number" id="demandQuantity" placeholder="Required Quantity">
<select id="demandUnit">
<option value="kg">kg</option>
<option value="quintal">quintal</option>
<option value="ton">ton</option>
</select>
<button onclick="createDemand()">Create Demand</button>
<div id="demandResult"></div>
</div>

<div class="card">
<h2>ğŸ¤– Smart Match</h2>
<input type="number" id="matchDemandId" placeholder="Demand ID">
<button onclick="findMatch()">Find Best Match</button>
<div id="matchResult"></div>
</div>

</div>

<script>

const BASE_URL="https://agrisync-hackathon.onrender.com";
let storedFarmerId=null;

async function loadDashboard(){
const res=await fetch(`${BASE_URL}/dashboard`);
const data=await res.json();
dashboardStats.innerHTML=
`ğŸ‘¨â€ğŸŒ¾ Farmers: <b>${data.total_farmers}</b><br>
ğŸŒ¾ Harvests: <b>${data.total_harvests}</b><br>
ğŸ›’ Buyers: <b>${data.total_buyers}</b><br>
ğŸ“¦ Demands: <b>${data.total_demands}</b>`;
}
loadDashboard();

async function registerFarmer(){
const res=await fetch(`${BASE_URL}/register-farmer`,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
name:farmerName.value,
phone:farmerPhone.value,
location:farmerLocation.value
})
});
const data=await res.json();
storedFarmerId=data.farmer_id;
farmerResult.innerHTML=`<div class="success-box">Farmer ID: ${data.farmer_id}</div>`;
loadDashboard();
}

async function addHarvest(){
if(!storedFarmerId){alert("Register farmer first");return;}
let qty=parseFloat(quantity.value);
if(unit.value==="quintal") qty*=100;
if(unit.value==="ton") qty*=1000;

const res=await fetch(`${BASE_URL}/add-harvest`,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
farmer_id:storedFarmerId,
crop_name:cropName.value,
quantity:qty,
expected_harvest_date:harvestDate.value
})
});
const data=await res.json();
harvestResult.innerHTML=
`<div class="success-box">
Score: ${data.harvest_score}<br>
Days Remaining: ${data.days_remaining}
</div>`;
loadDashboard();
}

async function registerBuyer(){
const res=await fetch(`${BASE_URL}/register-buyer`,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
name:buyerName.value,
phone:buyerPhone.value,
location:buyerLocation.value
})
});
const data=await res.json();
buyerResult.innerHTML=`<div class="success-box">Buyer ID: ${data.buyer_id}</div>`;
loadDashboard();
}

async function createDemand(){
let qty=parseFloat(demandQuantity.value);
if(demandUnit.value==="quintal") qty*=100;
if(demandUnit.value==="ton") qty*=1000;

const res=await fetch(`${BASE_URL}/add-demand`,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
buyer_id:parseInt(buyerIdInput.value),
crop_name:demandCrop.value,
quantity_required:qty
})
});
const data=await res.json();
demandResult.innerHTML=`<div class="success-box">Demand ID: ${data.demand_id}</div>`;
loadDashboard();
}

async function findMatch(){
const res=await fetch(`${BASE_URL}/match-demand/${matchDemandId.value}`,{method:"POST"});
const data=await res.json();

if(data.message==="No matching harvest found âŒ"){
matchResult.innerHTML=`<div class="success-box">No match found</div>`;
return;
}

matchResult.innerHTML=
`<div class="success-box">
Farmer: ${data.farmer_name}<br>
Phone: ${data.farmer_phone}<br>
Location: ${data.farmer_location}<br>
Crop: ${data.crop_name}<br>
Available: ${data.available_quantity} kg<br>
Price: â‚¹ ${data.suggested_price_per_kg} per kg<br>
Days Remaining: ${data.days_remaining}
</div>`;
}
</script>

</body>
</html>